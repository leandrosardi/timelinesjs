/*
 * ## TIMELINES.JS
 * Timelines.js
 * 
 * This library follows the best practices enumarated here:
 * https://www.w3.org/community/webed/wiki/JavaScript_best_practices
 * 
 * 
 */


var timelinesJs = {

	/*
	 * Returns the version of this commonsJs library.
	 *  
	 */
	version: function() {
		return '1.0.1';
	},
	
	/*
	 * Draws the timeline container
	 *  
	 */
	draw: function(parent) {
		$(parent).html("<div class='timeline'> </div>");
	},

	/*
	 * Adds a dot to the timeline.
	 * 
	 */
	addDot: function(parent, h) {
		// parse configuration
		var id = h['id']; // default value is ''
			if (commonsJs.isDefined(id) == false) { id=''; }

		var title = h['title']; // default value is ''
			if (commonsJs.isDefined(title) == false) { title=''; }

		var left_or_right = 'left'; // default value is left
			if (h['left'] == false) { left_or_right = 'right'; }

		var add_button = h['add_button'] ; // default value is false
			if (add_button == null) { add_button = false; }

		var add_button_title = h['add_button_title']; // default value is ''
			if (commonsJs.isDefined(add_button_title) == false) { add_button_title=''; }

		// draw
		var o = $('<div></div>');
		o.attr('id', id);
		o.attr('class', 'container ' + left_or_right);
		o.attr('title', title);
		if (add_button == true) {
			var a = $('<button></button>');
			a.attr('class', 'add-button btn btn-link btn-block simple menu-link');
			a.attr('title', add_button_title);
			
			var d = $('<div></div>');
			d.attr('class', 'action text-center');

			var i = $('<i></i>');
			i.attr('class', 'icon-plus');
						
			d.html(i);
			a.html(d);
			o.html(a);
		}
		
		// add code
		$(parent).find('.timeline').append(o); 		

		// add-button callback function
		if ( commonsJs.isDefined(h['on_click_add_button']) == true ) { 
			$(parent).find('#'+id).find('.add-button').click(function() {
				h['on_click_add_button']();
			});
		}			
	},
	

	/*
	 * Adds a note to a dot
	 * 
	 */
	addNote: function(parent, dot_id, h) {
		// parse configuration
		var id = h['id']; // default value is ''
			if (commonsJs.isDefined(id) == false) { id=''; }

		var text = h['text']; // default value is ''
			if (commonsJs.isDefined(text) == false) { text=''; }

		var html = h['html']; // default value is ''
			if (commonsJs.isDefined(html) == false) { html=''; }

		var edit_button = h['edit_button'] ; // default value is false
			if (edit_button == null) { edit_button = false; }

		var copy_button = h['copy_button'] ; // default value is false
			if (copy_button == null) { copy_button = false; }

		var delete_button = h['delete_button'] ; // default value is false
			if (delete_button == null) { delete_button = false; }

		var data = h['data'] ; // default value is {}
			if (commonsJs.isDefined(data) == false) { data = {}; }
		
		// getting dot
		var dot = $(parent).find('#'+dot_id.toString());
		if (dot.length == 0) {
			throw "Dot with id '"+dot_id.toString()+"' not found.";
		}
		
		// draw
		var note = $('<div></div>');
		note.attr('id', id);
		note.attr('class', 'content');		
		for (var key in data) {
			note.attr('data-'+key, data[key]);
		}
		
		var p = $('<p></p>');
		p.text(text);
		p.append(html);
	
		note.html(p);

		var actions_div = $('<div></div>');
		actions_div.attr('class', 'actions');
		note.append(actions_div);

		if (edit_button == true) {
			var a = $('<button></button>');
			a.attr('class', 'edit-button btn btn-link btn-normal simple menu-link');
			a.attr('title', 'edit');
			
			var i = $('<i></i>');
			i.attr('class', 'icon-pencil');

			a.html(i);
			actions_div.append(a);
		}

		if (copy_button == true) {
			var a = $('<button></button>');
			a.attr('class', 'copy-button btn btn-link btn-normal simple menu-link');
			a.attr('title', 'copy');
			
			var i = $('<i></i>');
			i.attr('class', 'icon-copy');

			a.html(i);
			actions_div.append(a);
		}

		if (delete_button == true) {
			var a = $('<button></button>');
			a.attr('class', 'delete-button btn btn-link btn-normal simple menu-link');
			a.attr('title', 'remove');
			
			var i = $('<i></i>');
			i.attr('class', 'icon-trash');

			a.html(i);
			actions_div.append(a);
		}

		// add code
		// si este dot tiene un boton icon-plus al final, entonces agrego la nota justo antes del dicho boton.
		// si este dot NO tiene un boton icon-plus al final, entonces agrego la nota al final.
		if ( commonsJs.isDefined(h['before']) ) {
			note.insertBefore('#' +dot.attr('id')+ ' #'+ h['before']);			
		} else if ( $('#' +dot.attr('id')+ ' .add-button').length == 1 ) {
			note.insertBefore('#' +dot.attr('id')+ ' .add-button');			
		} else {
			dot.append(note);
		}

		// edit-button callback function
		if ( commonsJs.isDefined(h['on_click_edit_button']) == true ) { 
			$(parent).find('#'+dot_id).find('#'+id).find('.edit-button').click(function() {
				h['on_click_edit_button']();
			});
		}

		// copy-button callback function
		if ( commonsJs.isDefined(h['on_click_copy_button']) == true ) { 
			$(parent).find('#'+dot_id).find('#'+id).find('.copy-button').click(function() {
				h['on_click_copy_button']();
			});
		}

		// delete-button callback function
		if ( commonsJs.isDefined(h['on_click_delete_button']) == true ) { 
			$(parent).find('#'+dot_id).find('#'+id).find('.delete-button').click(function() {
				h['on_click_delete_button']();
			});
		}

		// call the after_add_note function
		if ( commonsJs.isDefined(h['after_add_note']) == true ) { 
			h['after_add_note']();
		}
	},
	
	/*
	 * Removes a note from a dot
	 * 
	 */
	removeNote: function(parent, dot_id, note_id, h) {
		$(parent).find('#'+dot_id).find('#'+note_id).hide('fade', function() {
			$(parent).find('#'+dot_id).find('#'+note_id).remove();	

			// show or hide the delete buttons
			toggleNoteRemoveButtons();			

			// call the after_add_note function
			if ( commonsJs.isDefined(h['after_remove_note']) == true ) { 
				h['after_remove_note']();
			}
		});
	},

	/*
	 * Returns note content in HTML format.
	 * 
	 */
	getNoteHTML: function(parent, dot_id, note_id) {
		return $(parent).find('#'+dot_id).find('#'+note_id).find('p').html();
	},

	/*
	 * Returns note content as a raw plain-text.
	 * 
	 */
	getNoteText: function(parent, dot_id, note_id) {
		return $(parent).find('#'+dot_id).find('#'+note_id).find('p').text();
	},


	/*
	 * Returns the number of notes of a dot
	 * 
	 */
	notesCount: function(parent, dot_id) {
		return $(parent).find('#'+dot_id).find('.content').length;
	},

}; // var templatesJs;